#version: '3.0.1.{build}'

image: 
  - Ubuntu
 
cache:
  - downloads -> appveyor.yml
  - '%LOCALAPPDATA%\pip\Cache'
  - /var/cache/apt/archives
  - C:\ProgramData\chocolatey\bin -> appveyor.yml
  - C:\ProgramData\chocolatey\lib -> appveyor.yml

install:
  ### WINDOWS ###
  # add python and python user-base to path for pip installs
  - cmd: "C:\\%WINPYTHON%\\python.exe --version"
  - cmd: for /F "tokens=*" %%g in ('C:\\%WINPYTHON%\\python.exe -m site --user-base') do (set PYUSERBASESITE=%%g)
  - cmd: for /F "tokens=*" %%g in ('C:\\%WINPYTHON%\\python.exe -m site --user-site') do (set PYSITEDIR=%%g)
  - cmd: "set PATH=%PYUSERBASESITE%;%PYUSERBASESITE%\\%WINPYTHON%\\Scripts;%PYUSERBASESITE%\\Scripts;C:\\%WINPYTHON%;C:\\%WINPYTHON%\\Scripts;C:\\cygwin64\\bin;C:\\msys64;C:\\ProgramData\\chocolatey\\bin;%PATH%"
  - cmd: "C:\\%WINPYTHON%\\python.exe -m pip install --user -U pip setuptools wheel"
  - cmd: "C:\\%WINPYTHON%\\python.exe -m pip install --user -U pypiwin32 coverage coveralls codecov"
  - cmd: set STATIC_DEPS=true & C:\\%WINPYTHON%\\python.exe -m pip install --user -U lxml
  # install 3rd party tools to test with
  - cmd: choco install --allow-empty-checksums dmd
  - cmd: choco install --allow-empty-checksums ldc
  - cmd: choco install --allow-empty-checksums swig
  - cmd: choco install --allow-empty-checksums vswhere
  - cmd: choco install --allow-empty-checksums xsltproc
  - cmd: set
  ### LINUX ###
  #- sh: ./.travis/install.sh
  # java 9 and greater prints to stderr when this is set, failing several java tests
  - sh: echo "unset JAVA_TOOL_OPTIONS" | sudo tee --append ~/.bashrc
  - sh: echo "unset JAVA_TOOL_OPTIONS" | sudo tee --append ~/.profile
  - sh: echo "unset JAVA_TOOL_OPTIONS" | sudo tee --append /etc/environment
  - sh: echo "unset JAVA_TOOL_OPTIONS" | sudo tee --append /etc/profile
  - sh: unset JAVA_TOOL_OPTIONS
  # workaround for https://github.com/codecov/codecov-python/pull/188
  - sh: export CI=True
  - sh: export APPVEYOR=True
  - sh: printenv | grep JAVA_TOOL_OPTIONS


environment:
  COVERAGE: 0
  matrix:
    - WINPYTHON: "Python27"
      PYTHON: "2.7"
      PYVER: 27
      BUILD_JOB_NUM: 1
      COVERAGE: 1
    - WINPYTHON: "Python27"
      PYTHON: "2.7"
      PYVER: 27
      BUILD_JOB_NUM: 2
      COVERAGE: 1
    - WINPYTHON: "Python27"
      PYTHON: "2.7"
      PYVER: 27
      BUILD_JOB_NUM: 3
      COVERAGE: 1
    - WINPYTHON: "Python27"
      PYTHON: "2.7"
      PYVER: 27
      BUILD_JOB_NUM: 4
      COVERAGE: 1

    - WINPYTHON: "Python36"
      PYTHON: "3.6"
      PYVER: 36
      BUILD_JOB_NUM: 1
      COVERAGE: 1
    - WINPYTHON: "Python36"
      PYTHON: "3.6"
      PYVER: 36
      BUILD_JOB_NUM: 2
      COVERAGE: 1
    - WINPYTHON: "Python36"
      PYTHON: "3.6"
      PYVER: 36
      BUILD_JOB_NUM: 3
      COVERAGE: 1
    - WINPYTHON: "Python36"
      PYTHON: "3.6"
      PYVER: 36
      BUILD_JOB_NUM: 4
      COVERAGE: 1

    - WINPYTHON: "Python35"
      PYTHON: "3.5"
      PYVER: 35
      BUILD_JOB_NUM: 1
    - WINPYTHON: "Python35"
      PYTHON: "3.5"
      PYVER: 35
      BUILD_JOB_NUM: 2
    - WINPYTHON: "Python35"
      PYTHON: "3.5"
      PYVER: 35
      BUILD_JOB_NUM: 3
    - WINPYTHON: "Python35"
      PYTHON: "3.5"
      PYVER: 35
      BUILD_JOB_NUM: 4
    - WINPYTHON: "Python35"
      PYTHON: "3.5"
      PYVER: 35
      BUILD_JOB_NUM: 1

    - WINPYTHON: "Python37"
      PYTHON: "3.7"
      PYVER: 37
      BUILD_JOB_NUM: 1
    - WINPYTHON: "Python37"
      PYTHON: "3.7"
      PYVER: 37
      BUILD_JOB_NUM: 2
    - WINPYTHON: "Python37"
      PYTHON: "3.7"
      PYVER: 37
      BUILD_JOB_NUM: 3
    - WINPYTHON: "Python37"
      PYTHON: "3.7"
      PYVER: 37
      BUILD_JOB_NUM: 4

matrix:	
  exclude:	
    # test python 2 on Visual Studio 2015 image
    - image: Visual Studio 2015	
      WINPYTHON: "Python37"	
    - image: Visual Studio 2015	
      WINPYTHON: "Python36"	
    - image: Visual Studio 2015	
      WINPYTHON: "Python35"

    # test python 3.6 on Visual Studio 2017 image
    - image: Visual Studio 2017	
      WINPYTHON: "Python27"
    - image: Visual Studio 2017	
      WINPYTHON: "Python35"
    - image: Visual Studio 2017	
      WINPYTHON: "Python37" 

    # test python 2 on Ubuntu
    - image: Ubuntu	
      WINPYTHON: "Python37"	
    - image: Ubuntu		
      WINPYTHON: "Python35"
    - image: Ubuntu		
      WINPYTHON: "Python36"

  
build: off
